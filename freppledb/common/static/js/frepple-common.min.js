/* frePPLe 4.0.0
Copyright (C) 2010-2019 by frePPLe bv

This library is free software; you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License as published
by the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
General Public License for more details.

You should have received a copy of the GNU Affero General Public
License along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

function webfactory(e,n,o){"use strict";var t=!0,r=n(service_url,{reconnectIfNotNormalClose:!0});return o(function(){r.send("/alive/")},6e5),r.onMessage(function(n){var o=angular.fromJson(n.data);t&&console.log(o),e.$broadcast("websocket-"+o.category,o)}),r.onError(function(e){e="<p>Websocket connection is not working.</p><p>Please check that <strong>plan.webservice</strong> parameter is set to <strong>true</strong>,<br>and <strong>execute the plan</strong>.</p>",angular.element("#controller").scope().databaseerrormodal=!0,angular.element("#controller").scope().$apply(),angular.element(document).find("#popup2 .modal-title span").html("Websocket connection problem"),angular.element(document).find(".modal-body").html('<div style="width: 100%; overflow: auto;">'+e+"</div>"),angular.element(document).find("#popup2").modal("show"),angular.element("#controller").scope().$apply()}),{send:function(e){r.readyState>1&&(r=n(service_url)),t&&console.log("send:"+e),r.send(e)},subscribe:function(n,o){var t=e.$on("websocket-"+n,function(e,n){o(n)});e.$on("$destroy",t)}}}function PreferenceSvc(e){"use strict";var n="freppledb.planningboard",o=preferences;return o=void 0!==o&&"None"!==o?angular.fromJson(preferences):{},{get:function(e,n){return e in o?o[e]:n},save:function(t,r,a){"object"==typeof t&&t.length===r.length?angular.forEach(t,function(e,n){o[e]=r[n]}):o[t]=r;var c="/"+angular.element(document).find("#database").attr("name");"/default"!==c&&"/undefined"!==c||(c="");var l={};l[n]=o,e.post(c+"/settings/",angular.toJson(l)).then(function(e){"function"==typeof a&&a(e)},function(e){angular.element(document).find(".modal-body").html('<div style="width: 100%; overflow: auto;">'+e.data+"</div>"),angular.element(document).find("#popup2").modal("show")})}}}angular.module("frepple.common",[]),angular.module("frepple.common").constant("getURLprefix",function(){return"default"===database?"":"/"+database}),angular.module("frepple.common").filter("dateTimeFormat",function(){return function(e,n){return n=n||"YYYY-MM-DD HH:mm:ss",e?e.format(n):""}}),angular.module("frepple.common").factory("WebSvc",webfactory),webfactory.$inject=["$rootScope","$websocket","$interval"],angular.module("frepple.common").service("PreferenceSvc",PreferenceSvc),PreferenceSvc.$inject=["$http"];
//# sourceMappingURL=frepple-common.min.js.map