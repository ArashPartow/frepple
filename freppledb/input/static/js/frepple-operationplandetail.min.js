/* frePPLe 4.0.0
Copyright (C) 2010-2019 by frePPLe bv

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files(the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/ or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT.IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

angular.module("calendar",[]).constant("calendarConfig",{formatDay:"d",formatDayHeader:"EEE",formatDayTitle:"MMMM dd, yyyy",formatWeekTitle:"MMMM yyyy, Week w",formatMonthTitle:"MMMM yyyy",formatWeekViewDayHeader:"EEE d",formatHourColumn:"ha",showWeeks:!0}).controller("calendarController",["$scope","$attrs","$parse","$interpolate","$log","dateFilter","gettextCatalog","calendarConfig","PreferenceSvc",function(e,a,t,n,r,o,i,d,l){"use strict";var p=this,s={$setViewValue:angular.noop};angular.forEach(["formatDay","formatDayHeader","formatDayTitle","formatWeekTitle","formatMonthTitle","formatWeekViewDayHeader","formatHourColumn"],function(t,r){p[t]=angular.isDefined(a[t])?n(a[t])(e.$parent):d[t]}),angular.forEach(["showWeeks"],function(t,n){p[t]=angular.isDefined(a[t])?e.$parent.$eval(a[t]):d[t]}),p.hourParts=3600;var c=e.$parent.$watch(a.eventSource,function(e){p.onEventSourceChanged(e)});e.$on("$destroy",c),e.admin_escape=admin_escape,e.url_prefix=url_prefix,e.scrollBarWidth=getScrollBarWidth(),e.calendarmode=calendarmode,e.grouping=grouping,e.groupingdir=groupingdir,e.grid=grid,e.groupingcfg=groupingcfg,e.calendarmodes={start:i.getString("View start events"),end:i.getString("View end events"),start_end:i.getString("View start and end events"),duration:i.getString("View full duration")},e.setCalendarMode=function(a){e.calendarmode=a,l.save("calendarmode",a)},e.setGrouping=function(a){e.grouping=a,l.save("grouping",a),p._onDataLoaded()},e.setGroupingDir=function(a){e.groupingdir=a,l.save("groupingdir",a),p._onDataLoaded()},angular.isDefined(a.initDate)&&(p.currentCalendarDate=e.$parent.$eval(a.initDate)),p.currentCalendarDate||(p.currentCalendarDate=currentdate,a.ngModel&&!e.$parent.$eval(a.ngModel)&&t(a.ngModel).assign(e.$parent,p.currentCalendarDate)),e.getHeight=function(e){if(preferences&&preferences.details&&"bottom"!=preferences.details){var a=angular.element(document).find("#content-main");return Math.max(150,$(window).height()-a.offset().top-e-40)}return preferences&&preferences.height?preferences.height-e:220-e},e.displayEvent=function(a,t){switch(e.calendarmode){case"duration":return!0;case"start_end":return moment(a.operationplan__startdate||a.startdate||a.operationplan__enddate||a.enddate).isSame(t.date,"day")||moment(a.operationplan__enddate||a.enddate||a.operationplan__startdate||a.startdate).isSame(t.date,"day");case"start":return moment(a.operationplan__startdate||a.startdate||a.operationplan__enddate||a.enddate).isSame(t.date,"day");case"end":return moment(a.operationplan__enddate||a.enddate||a.operationplan__startdate||a.startdate).isSame(t.date,"day")}},e.isStart=function(e,a){var t=e.startdate||e.operationplan__startdate;return!!t&&(a instanceof Date?t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate():moment(t).isSame(a.date,"day"))},e.isEnd=function(e,a){var t=e.enddate||e.operationplan__enddate;return!!t&&(t>(e.startdate||e.operationplan__startdate)&&(t=new Date(t-1)),a instanceof Date?t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate():moment(t).isSame(a.date,"day"))},e.displayEvent=function(a,t){switch(e.calendarmode){case"duration":return!0;case"start_end":return!!a.startdate&&moment(a.startdate).isSame(t.date,"day")||!!a.enddate&&moment(a.enddate>a.startdate?a.enddate-1:a.enddate).isSame(t.date,"day");case"start":return!!a.startdate&&moment(a.startdate).isSame(t.date,"day");case"end":return!!a.enddate&&moment(a.enddate>a.startdate?a.enddate-1:a.enddate).isSame(t.date,"day")}},p.init=function(e){(s=e).$render=function(){p.render()}},p.render=function(){if(s.$modelValue){var e=new Date(s.$modelValue),a=!isNaN(e);a?this.currentCalendarDate=e:r.error('"ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.'),s.$setValidity("date",a)}this.refreshView()},p.refreshView=function(){this.mode&&(this.range=this._getRange(this.currentCalendarDate),this._refreshView(),this.rangeChanged())},p.split=function(e,a){for(var t=[];e.length>0;)t.push(e.splice(0,a));return t},p.onEventSourceChanged=function(e){p.eventSource=e,p._onDataLoaded&&p._onDataLoaded()},e.move=function(a){var t,n=p.mode.step,r=p.currentCalendarDate,o=r.getFullYear()+a*(n.years||0),i=r.getMonth()+a*(n.months||0),d=r.getDate()+a*(n.days||0);r.setFullYear(o,i,d),"calendarmonth"===e.mode&&(t=new Date(o,i+1,1)).getTime()<=r.getTime()&&(p.currentCalendarDate=new Date(t-864e5)),s.$setViewValue(p.currentCalendarDate),p.refreshView()},p.move=function(a){e.move(a)},p.changeMode=function(a){e.mode=a},p.rangeChanged=function(){e.rangeChanged?e.rangeChanged({startdate:this.range.startdate,enddate:this.range.enddate}):console.error("No rangeChanged callback is registered")}}]).directive("calendar",function(){"use strict";return{restrict:"EA",replace:!0,templateUrl:"/static/operationplandetail/calendar.html",scope:{mode:"=",editable:"=",rangeChanged:"&",eventSelected:"&",timeSelected:"&"},require:["calendar","?^ngModel"],controller:"calendarController",link:function(e,a,t,n){var r,o=n[0],i=n[1];function d(a){var t=new Date(a.originalEvent.dataTransfer.getData("dragstart")),n=new Date($(a.target).closest(".datecell").attr("data-date")),o=a.originalEvent.dataTransfer.getData("dragreference"),i=a.originalEvent.dataTransfer.getData("dragrow"),d=$(a.target).closest("[data-row]").attr("data-row");if("resource"!==e.grouping||i!=d||t.getTime()!==n.getTime()){if("resource"!==e.grouping&&t.getTime()===n.getTime())return a.preventDefault(),void(d=i);e.$apply(function(){for(var a of e.$parent.calendarevents)if((a.id||a.reference)==o){var l=!1;if(e.isStart(a,t))a.hasOwnProperty("operationplan__startdate")?(e.changeCard(a,"operationplan__startdate",a.operationplan__startdate,n),a.operationplan__startdate=n,a.startdate=n,a.operationplan__enddate<n&&(a.operationplan__enddate=n),l=!0):a.hasOwnProperty("startdate")&&(e.changeCard(a,"startdate",a.startdate,n),a.startdate=n,a.enddate<n&&(a.enddate=n),l=!0);else if(e.isEnd(a,t))a.hasOwnProperty("operationplan__enddate")?(e.changeCard(a,"operationplan__enddate",a.operationplan__enddate,n),a.operationplan__enddate=n,a.enddate=n,a.operationplan__startdate>n&&(a.operationplan__startdate=n),l=!0):a.hasOwnProperty("enddate")&&(e.changeCard(a,"enddate",a.enddate,n),a.enddate=n,a.startdate>n&&(a.startdate=n),l=!0);else{var p=(n-t)/864e5;if(a.hasOwnProperty("operationplan__startdate"))(s=new Date(a.operationplan__startdate)).setDate(a.operationplan__startdate.getDate()+p),e.changeCard(a,"operationplan__startdate",a.operationplan__startdate,s),a.operationplan__startdate=s,a.startdate=s,a.operationplan__enddate<s&&(a.operationplan__enddate=n),l=!0;else if(a.hasOwnProperty("startdate")){var s;(s=new Date(a.startdate)).setDate(a.startdate.getDate()+p),e.changeCard(a,"startdate",a.startdate,s),a.startdate=s,a.enddate<s&&(a.enddate=s),l=!0}}i!=d&&a.resource==i&&(e.changeCard(a,"resource",a.row_dragstart,d),a.resource=d,l=!0),l&&r&&r(a,!0);break}}),a.preventDefault()}else a.preventDefault()}function l(e){e.originalEvent.dataTransfer.setData("dragstart",$(e.target).closest(".datecell").attr("data-date")),e.originalEvent.dataTransfer.setData("dragreference",$(e.target).closest(".card").attr("data-reference")),e.originalEvent.dataTransfer.setData("dragrow",$(e.target).closest("[data-row]").attr("data-row")),e.stopPropagation()}function p(e){e.preventDefault()}function s(){a.off("dragover","td.datecell",p),a.off("drop","td.datecell",d),a.off("dragstart",".card",l),r=null}e.curselected=null,i&&o.init(i),e.$on("selectedEdited",function(a,t,n,r){if(null!==e.curselected&&(!e.mode||e.mode.startsWith("calendar")))if("loadplans"==t){var o=[];angular.forEach(r,function(e){o.push([e.resource.name,e.quantity])}),e.changeCard(e.curselected,"resource",e.curselected.resource,o),e.curselected.resource=o}else e.changeCard(e.curselected,t,n),e.curselected[t]=r}),e.$on("changeDate",function(e,a){o.move(a)}),e.$on("eventSourceChanged",function(e,a){o.onEventSourceChanged(a)}),e.selectCard=function(a){if(e.curselected){if(e.curselected.reference&&e.curselected.reference==a.reference&&a.selected)return;if(e.curselected.operationplan__reference&&e.curselected.operationplan__reference==a.reference&&a.selected)return;delete e.curselected.selected}a.selected=!0,e.curselected=a,e.eventSelected({event:a}),angular.element(document).find("#delete_selected, #gridactions").prop("disabled",!1)},e.changeCard=function(a,t,n,r){a.hasOwnProperty(t+"Original")||(a[t+"Original"]=n),a.dirty=!0,angular.element(document).find("#save, #undo").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges),$(window).on("beforeunload",upload.warnUnsavedChanges),void 0!==r&&e.$parent.$broadcast("cardChanged",t,n,r)},e.enableDragDrop=function(e){s(),a.on("dragover","td.datecell",p),a.on("drop","td.datecell",d),a.on("dragstart",".card",l),r=e},e.disableDragDrop=s}}}).directive("monthview",["dateFilter",function(e){"use strict";return{restrict:"EA",replace:!0,templateUrl:"/static/operationplandetail/month.html",require:["^calendar","?^ngModel"],link:function(a,t,n,r){var o=r[0],i=r[1];function d(a,t){return{date:a,label:e(a,t),selected:0===o.compare(a,o.currentCalendarDate),current:0===o.compare(a,currentdate)}}function l(e,a){return(e.startdate?e.startdate:e.enddate).getTime()-(a.startdate?a.startdate:a.enddate)}function p(e,t){var n,r,i,d,l=e.startdate?new Date(e.startdate):null,p=e.enddate?new Date(e.enddate):null;if((p||l)<=o.range.startdate||(l||p)>=o.range.enddate)return!1;n=o.range.startdate,r=o.range.enddate,p||(p=l),l||(l=p),i=l<=n?0:(l-n-6e4*(l.getTimezoneOffset()-n.getTimezoneOffset()))/864e5,d=p>=r?(r-n-6e4*(r.getTimezoneOffset()-n.getTimezoneOffset()))/864e5:(p-n-6e4*(p.getTimezoneOffset()-n.getTimezoneOffset()))/864e5;for(var s,c=Math.floor(i),u=c-1;t&&u>=0;){var f=Math.floor(u/7),m=Math.floor(u%7),g=!1;if(s=a.rows[f][m].events)for(var h=s.length-1;h>=0;h--)if((e.id||e.reference)==(s[h].id||s[h].reference)){s.splice(h,1),g=!0;break}if(!g)break;u-=1}for(var v=!0;v||c<d;){v=!1;f=Math.floor(c/7),m=Math.floor(c%7);if(s=a.rows[f][m].events){g=!1;if(t)for(var h of s)if((e.id||e.reference)==(h.id||h.reference)){g=!0;break}g||s.push(e)}else(s=[]).push(e),a.rows[f][m].events=s;c+=1}for(;t;){f=Math.floor(c/7),m=Math.floor(c%7);if(f>=a.rows.length||m>=a.rows[f].length)break;g=!1;if(s=a.rows[f][m].events)for(h=s.length-1;h>=0;h--)if((e.id||e.reference)==(s[h].id||s[h].reference)){s.splice(h,1),g=!0;break}if(!g)break;c+=1}return!0}function s(e){var a=new Date(e.getFullYear(),0,1).getDay(),t=new Date(e.getFullYear(),0,(a<=4?5:12)-a),n=new Date(e.getFullYear(),e.getMonth(),e.getDate()+(4-e.getDay()))-t;return 1+Math.round(n/6048e5)}a.showWeeks=o.showWeeks,o.mode={step:{months:1}},a.select=function(e){var t=a.rows,n=e.date,r=e.events;if(t){var d=o.currentCalendarDate,l=d.getMonth(),p=d.getFullYear(),s=n.getMonth(),c=n.getFullYear(),u=0;if(p===c?l!==s&&(u=l<s?1:-1):u=p<c?1:-1,o.currentCalendarDate=n,i&&i.$setViewValue(n),0===u)for(var f=0;f<6;f+=1)for(var m=0;m<7;m+=1){var g=0===o.compare(n,t[f][m].date);t[f][m].selected=g,g&&(a.selectedDate=t[f][m])}else o.refreshView();a.timeSelected&&a.timeSelected({selectedTime:n,events:r})}},o._refreshView=function(){for(var t=o.range.startdate,n=t.getDate(),r=(t.getMonth()+(1!==n?1:0))%12,i=t.getFullYear()+(1!==n&&0===r?1:0),l=function(e,a){var t=new Array(a),n=new Date(e),r=0;for(n.setHours(12);r<a;)t[r++]=new Date(n),n.setDate(n.getDate()+1);return t}(t,42),p=0;p<42;p++)l[p]=angular.extend(d(l[p],o.formatDay),{secondary:l[p].getMonth()!==r});a.labels=new Array(7);for(var c=0;c<7;c++)a.labels[c]=e(l[c].date,o.formatDayHeader);var u=new Date(i,r,1);if(a.$parent.title=e(u,o.formatMonthTitle),a.rows=o.split(l,7),a.showWeeks){a.weekNumbers=[];for(var f=a.rows.length,m=0;m<f;m++)a.weekNumbers.push(s(a.rows[m][3].date))}},o._onDataLoaded=function(){var e,t,n=o.eventSource,r=a.rows,i=[];for(e=0;e<6;e+=1)for(t=0;t<7;t+=1)r[e][t].events=null;for(var d of n)p(d,!1)&&a.grouping&&!i.includes(d[a.grouping])&&i.push(d[a.grouping]);for(e=0;e<6;e+=1)for(t=0;t<7;t+=1)r[e][t].events&&r[e][t].events.sort(l);var s=!1;for(e=0;e<6;e+=1){for(t=0;t<7;t+=1)if(r[e][t].selected){a.selectedDate=r[e][t],s=!0;break}if(s)break}a.grouping?a.groupingdir&&"desc"==a.groupingdir?a.categories=i.sort().reverse():a.categories=i.sort():a.categories=["dummy"]},a.$on("duplicateOperationplan",function(e,t,n){for(var r=0;r<6;r+=1)for(var o=0;o<7;o+=1)if(a.rows[r][o].events){var i=[];for(var e of a.rows[r][o].events)i.push(e),e.reference==t.reference&&i.push(n);a.rows[r][o].events=i}a.selectCard(n)}),a.$on("changeMode",function(e,t){o.changeMode(t),a.editable&&"calendarmonth"==t?a.enableDragDrop(p):a.disableDragDrop()}),o.compare=function(e,a){return new Date(e.getFullYear(),e.getMonth(),e.getDate())-new Date(a.getFullYear(),a.getMonth(),a.getDate())},o._getRange=function(e){var a,t=e.getFullYear(),n=e.getMonth(),r=new Date(t,n,1),o=1-r.getDay(),i=o>0?7-o:-o,d=new Date(r);return i>0&&d.setDate(1-i),(a=new Date(d)).setDate(a.getDate()+42),{startdate:d,enddate:a}},o.refreshView(),a.editable&&"calendarmonth"==a.mode&&a.enableDragDrop(p)}}}]).directive("weekview",["dateFilter",function(e){"use strict";return{restrict:"EA",replace:!0,templateUrl:"/static/operationplandetail/week.html",require:"^calendar",link:function(a,t,n,r){function o(e,t){var n,o,i=e.startdate?new Date(e.startdate):null,d=e.enddate?new Date(e.enddate):null;if((d||i)<=r.range.startdate||(i||d)>=r.range.enddate)return!1;d||(d=i),i||(i=d),n=i<=r.range.startdate?0:(i-r.range.startdate-6e4*(i.getTimezoneOffset()-r.range.startdate.getTimezoneOffset()))/36e5,o=d>=r.range.enddate?(r.range.enddate-r.range.startdate-6e4*(r.range.enddate.getTimezoneOffset()-r.range.startdate.getTimezoneOffset()))/36e5:(d-r.range.startdate-6e4*(d.getTimezoneOffset()-r.range.startdate.getTimezoneOffset()))/36e5;for(var l=Math.floor(n),p=Math.ceil((o-.016)/24),s=Math.floor(l/24),c=s-1;t&&c>=0;){var u=!1,f=a.dates[c].events;if(f)for(var m=f.length-1;m>=0;m--)if((e.id||e.reference)==(f[m].id||f[m].reference)){f.splice(m,1),u=!0;break}if(!u)break;c-=1}do{if(a.dates[s].events){u=!1;if(t)for(var m of a.dates[s].events)if((e.id||e.reference)==(m.id||m.reference)){u=!0;break}u||a.dates[s].events.push(e)}else a.dates[s].events=[e];s+=1}while(s<p);for(;t&&s<7;){u=!1;if(f=a.dates[s].events)for(m=f.length-1;m>=0;m--)if((e.id||e.reference)==(f[m].id||f[m].reference)){f.splice(m,1),u=!0;break}if(!u)break;s+=1}return!0}a.formatWeekViewDayHeader=r.formatWeekViewDayHeader,a.formatHourColumn=r.formatHourColumn,r.mode={step:{days:7}},a.hourParts=r.hourParts,a.select=function(e,t){a.timeSelected&&a.timeSelected({selectedTime:e,events:t})},r._onDataLoaded=function(){for(var e=r.eventSource,t=[],n=0;n<7;n+=1)a.dates[n].events&&(a.dates[n].events=null);for(var i of e)o(i,!1)&&a.grouping&&!t.includes(i[a.grouping])&&t.push(i[a.grouping]);a.grouping?a.groupingdir&&"desc"==a.groupingdir?a.categories=t.sort().reverse():a.categories=t.sort():a.categories=["dummy"]},a.$on("duplicateOperationplan",function(e,t,n){for(var r=0;r<7;r+=1)if(a.dates[r].events){var o=[];for(var e of a.dates[r].events)o.push(e),e.reference==t.reference&&o.push(n);a.dates[r].events=o}a.selectCard(n)}),a.$on("changeMode",function(e,t){r.changeMode(t),a.editable&&"calendarweek"==t?a.enableDragDrop(o):a.disableDragDrop()}),r._refreshView=function(){var t,n;a.dates=function(e,a){var t=new Array(a),n=new Date(e),r=0;for(n.setHours(12);r<a;)t[r++]={date:new Date(n)},n.setDate(n.getDate()+1);return t}(r.range.startdate,7),t=r.formatWeekTitle.indexOf("w"),n=e(r.range.startdate,r.formatWeekTitle),-1!==t&&(n=n.replace("w",function(e){var a=new Date(e);a.setDate(a.getDate()+4-(a.getDay()||7));var t=a.getTime();return a.setMonth(0),a.setDate(1),Math.floor(Math.round((t-a)/864e5)/7)+1}(r.range.startdate))),a.$parent.title=n},r._getRange=function(e){var a=e.getFullYear(),t=e.getMonth(),n=e.getDate(),r=e.getDay();return{startdate:new Date(a,t,n-r),enddate:new Date(a,t,n-r+7)}},r.refreshView(),a.editable&&"calendarweek"==a.mode&&a.enableDragDrop(o)}}}]).directive("dayview",["dateFilter",function(e){"use strict";return{restrict:"EA",replace:!0,templateUrl:"/static/operationplandetail/day.html",require:"^calendar",link:function(a,t,n,r){function o(e,a){}a.formatHourColumn=r.formatHourColumn,r.mode={step:{days:1}},a.hourParts=r.hourParts,a.events=[],a.select=function(e,t){a.timeSelected&&a.timeSelected({selectedTime:e,events:t})},a.$on("duplicateOperationplan",function(e,t,n){var r=[];for(var e of a.events)r.push(e),e.reference==t.reference&&r.push(n);a.events=r,a.selectCard(n)}),a.$on("changeMode",function(e,t){r.changeMode(t),a.editable&&"calendarday"==t?a.enableDragDrop(o):a.disableDragDrop()}),r._onDataLoaded=function(){var e=r.eventSource,t=r.range.startdate,n=r.range.enddate,o=[];for(var i of(a.events=null,e)){var d=i.startdate?new Date(i.startdate):null,l=i.enddate?new Date(i.enddate):null;(l||d)<=t||(d||l)>=n||(a.events?a.events.push(i):a.events=[i],a.grouping&&!o.includes(i[a.grouping])&&o.push(i[a.grouping]))}a.grouping?a.groupingdir&&"desc"==a.groupingdir?a.categories=o.sort().reverse():a.categories=o.sort():a.categories=["dummy"]},r._refreshView=function(){var t=r.range.startdate;a.rows=function(e){for(var t,n=[],r=e.getHours(),o=e.getDate(),i=0;i<24;i+=1)(t=new Date(e.getTime())).setHours(r+i),t.setDate(o),n.push({date:t});return a.dt={date:e},n}(t),a.dates=[t],a.$parent.title=e(t,r.formatDayTitle)},r._getRange=function(e){var a=e.getFullYear(),t=e.getMonth(),n=e.getDate();return{startdate:new Date(a,t,n),enddate:new Date(a,t,n+1)}},r.refreshView(),a.editable&&"calendarday"==a.mode&&a.enableDragDrop(o)}}}]);var operationplandetailapp=angular.module("operationplandetailapp",["ngCookies","gettext","ngWebSocket","frepple.input","frepple.common","calendar"],["$locationProvider",function(e){e.html5Mode({enabled:!0,requireBase:!1})}]);function operationplanCtrl(e,a,t,n){function r(e){if(void 0===e.color||""===e.color)return[void 0,""];var a=parseInt(e.color);if(e.inventory_item||e.leadtime){if(!isNaN(a))return a>=100&&a<999999?["rgba(0,128,0,0.5)",Math.round(e.computed_color)+"%"]:0===a?["rgba(255,0,0,0.5)",Math.round(e.computed_color)+"%"]:999999===a?[void 0,""]:["rgba(255,"+Math.round(a/100*255)+",0,0.5)",Math.round(e.computed_color)+"%"]}else{var t=Math.round(parseInt(e.delay)/8640)/10;if(isNaN(t)&&(t=Math.round(parseInt(e.operationplan__delay)/8640)/10),999===parseInt(e.criticality)||999===parseInt(e.operationplan__criticality))return[void 0,""];if(t<0)return["rgba(0,128,0,0.5)",-t+" "+gettext("days early")];if(0===t)return["rgba(0,128,0,0.5)",gettext("on time")];if(t>0)return a>100||a<0?["rgba(255,0,0,0.5)",t+" "+gettext("days late")]:["rgba(255,"+Math.round(a/100*255)+",0,0.5)",t+" "+gettext("days late")]}return[void 0,""]}function o(t){if(!t){var n=$("#grid").getGridParam("postData");t=n&&n.filters?JSON.parse(n.filters):initialfilter}var o=$("#grid").getGridParam("sortname"),i="";""!==o&&(i="&sidx="+encodeURIComponent(o)+"&sord="+encodeURIComponent($("#grid").getGridParam("sortorder")));var d=(-1!=location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):location.href)+(location.search.length>0?"&format=calendar":"?format=calendar")+"&calendarstart="+moment(e.calendarStart).format("YYYY-MM-DD%20HH:MM:SS")+"&calendarend="+moment(e.calendarEnd).format("YYYY-MM-DD%20HH:MM:SS")+i;a.get(d+"&filters="+encodeURIComponent(JSON.stringify(t))).then(function(a){var t=angular.copy(a.data);for(var n of t.rows)n.type=n.operationplan__type||n.type||default_operationplan_type,n.hasOwnProperty("enddate")&&(n.enddate=new Date(n.enddate)),n.hasOwnProperty("operationplan__enddate")&&(n.operationplan__enddate=new Date(n.operationplan__enddate),n.enddate=n.operationplan__enddate),n.hasOwnProperty("startdate")&&(n.startdate=new Date(n.startdate)),n.hasOwnProperty("operationplan__startdate")&&(n.operationplan__startdate=new Date(n.operationplan__startdate),n.startdate=n.operationplan__startdate),n.hasOwnProperty("quantity")&&(n.quantity=parseFloat(n.quantity)),n.hasOwnProperty("operationplan__quantity")&&(n.operationplan__quantity=parseFloat(n.operationplan__quantity)),n.hasOwnProperty("quantity_completed")&&(n.quantity_completed=parseFloat(n.quantity_completed)),n.hasOwnProperty("operationplan__quantity_completed")&&(n.operationplan__quantity_completed=parseFloat(n.operationplan__quantity_completed)),n.hasOwnProperty("operationplan__status")&&(n.status=n.operationplan__status),n.hasOwnProperty("operationplan__origin")&&(n.origin=n.operationplan__origin),[n.color,n.inventory_status]=r(n);e.calendarevents=t.rows,e.totalevents=t.records},function(e){401==e.status&&location.reload()})}e.operationplan=new t,e.aggregatedopplan=null,e.mode=preferences?preferences.mode:"table",e.detailposition=detailposition,e.operationplans=[],e.kanbanoperationplans={},e.deleted=[],e.kanbancolumns=preferences?preferences.columns:void 0,e.kanbancolumns||(e.kanbancolumns=["proposed","approved","confirmed","completed","closed"]),e.groupBy=preferences?preferences.groupBy:void 0,e.groupBy||("undefined"!=typeof groupBy?e.groupBy=groupBy:e.groupBy="status"),e.groupOperator=preferences?preferences.groupOperator:void 0,e.groupOperator||(e.groupOperator="eq"),e.displayongrid=displayongrid,"function"==typeof e.displayongrid&&e.$watchGroup(["operationplan.id","operationplan.start","operationplan.end","operationplan.quantity","operationplan.status","operationplan.quantity_completed","operationplan.remark","operationplan.loadplans","operationplan.resource"],function(a,t){t[0]===a[0]&&-1!==a[0]&&void 0!==t[0]&&(void 0!==t[1]&&void 0!==a[1]&&t[1]!==a[1]&&("kanban"==e.mode||e.mode.startsWith("calendar")?e.$broadcast("selectedEdited","startdate",t[1],new Date(e.operationplan.start)):e.displayongrid(e.operationplan.id,"startdate",e.operationplan.start)),void 0!==t[2]&&void 0!==a[2]&&t[2]!==a[2]&&("kanban"==e.mode||e.mode.startsWith("calendar")?e.$broadcast("selectedEdited","enddate",t[2],new Date(e.operationplan.end)):e.displayongrid(e.operationplan.id,"enddate",e.operationplan.end)),void 0!==t[3]&&void 0!==a[3]&&t[3]!==a[3]&&("kanban"==e.mode||e.mode.startsWith("calendar")?e.$broadcast("selectedEdited","quantity",t[3],e.operationplan.quantity):e.displayongrid(e.operationplan.id,"quantity",e.operationplan.quantity)),void 0!==t[4]&&void 0!==a[4]&&t[4]!==a[4]&&(actions.hasOwnProperty(e.operationplan.status)?"kanban"==e.mode||e.mode.startsWith("calendar")?e.$broadcast("selectedEdited","status",t[4],e.operationplan.status):e.displayongrid(e.operationplan.id,"status",e.operationplan.status):actions[Object.keys(actions)[0]]()),void 0!==t[5]&&void 0!==a[5]&&t[5]!==a[5]&&("kanban"==e.mode||e.mode.startsWith("calendar")?e.$broadcast("selectedEdited","quantity_completed",t[5],e.operationplan.quantity_completed):e.displayongrid(e.operationplan.id,"quantity_completed",e.operationplan.quantity_completed)),void 0!==t[6]&&void 0!==a[6]&&t[6]!==a[6]&&("kanban"==e.mode||e.mode.startsWith("calendar")?e.$broadcast("selectedEdited","remark",t[6],e.operationplan.remark):e.displayongrid(e.operationplan.id,"remark",e.operationplan.remark))),t[0]=a[0]}),e.processAggregatedInfo=function(a,n){var r=[],o={colmodel:{}},i=0;angular.forEach(n,function(e,a){e.hasOwnProperty("summaryType")&&(r.push([a,e.name,e.summaryType,e.formatter]),o[e.name]=null,o.colmodel[e.name]={type:e.summaryType,label:e.label,formatter:e.formatter})}),angular.forEach(a,function(e){angular.forEach(r,function(a){"sum"===a[2]?"duration"===a[3]?"Invalid Date"!==(i=new moment.duration(e[a[1]]).asSeconds())._d&&(null===o[a[1]]?o[a[1]]=i:o[a[1]]+=i):isNaN(parseFloat(e[a[1]]))||(null===o[a[1]]?o[a[1]]=parseFloat(e[a[1]]):o[a[1]]+=parseFloat(e[a[1]])):"max"===a[2]?-1!==["color","number","currency"].indexOf(a[3])&&""!==e[a[1]]?parseFloat(e[a[1]])&&(null===o[a[1]]?o[a[1]]=parseFloat(e[a[1]]):o[a[1]]=Math.max(o[a[1]],parseFloat(e[a[1]]))):"duration"===a[3]?"Invalid Date"!==(i=new moment.duration(e[a[1]]).asSeconds())._d&&(null===o[a[1]]?o[a[1]]=i:o[a[1]]=Math.max(o[a[1]],i)):"date"===a[3]&&"Invalid Date"!==(i=new moment(e[a[1]],datetimeformat))._d&&(null===o[a[1]]||i.isAfter(o[a[1]]))&&(o[a[1]]=i):"min"===a[2]&&(-1!==["color","number"].indexOf(a[3])&&""!==e[a[1]]?(i=parseFloat(e[a[1]]),isNaN(i)||(null===o[a[1]]?o[a[1]]=i:o[a[1]]=Math.min(o[a[1]],i))):"duration"===a[3]?"Invalid Date"!==(i=new moment.duration(e[a[1]]).asSeconds())._d&&(null===o[a[1]]?o[a[1]]=i:o[a[1]]=Math.min(o[a[1]],i)):"date"===a[3]&&"Invalid Date"!==(i=new moment(e[a[1]],datetimeformat))._d&&(null===o[a[1]]?o[a[1]]=i:o[a[1]]=moment.min(o[a[1]],i)))})}),angular.forEach(r,function(e){"duration"===e[3]&&(o[e[1]]=formatDuration(o[e[1]]))}),e.operationplan=new t,o.start=o.startdate||o.operationplan__startdate,moment.isMoment(o.start)&&(o.start=o.start.toDate()),o.end=o.enddate||o.operationplan__enddate,moment.isMoment(o.end)&&(o.end=o.end.toDate()),o.id=-1,o.count=a.length,o.type=a.length>0?a[0].type:"",o.count||angular.element(document).find("#delete_selected, #copy_selected").prop("disabled",!0),e.$apply(function(){e.operationplan.extend(o)})},e.$on("updateCard",function(a,t,n,r){e.$apply(function(){e.$broadcast("selectedEdited",t,n,r)})}),e.displayInfo=function(a){if("kanban"!=e.mode||void 0!==a)if(e.mode.startsWith("calendar")&&void 0===a)e.loadCalendarData();else{var n=void 0;void 0!==a&&(n=a.hasOwnProperty("operationplan__reference")?a.operationplan__reference:a.reference),angular.element(document).find("#delete_selected, #copy_selected").prop("disabled",!1),a&&a.hasOwnProperty("duplicated")?(e.operationplan=new t(a),e.operationplan.id=a.duplicated,e.operationplan.get(r)):(e.operationplan=new t,e.operationplan.id=n,void 0===e.operationplan.id?e.$apply(function(){angular.element(document).find("#delete_selected, #copy_selected").prop("disabled",!0),e.operationplan=new t}):e.operationplan.get(r))}else e.loadKanbanData();function r(t){if(void 0===a)return t;t.hasOwnProperty("duplicated")&&(t.reference=t.id="Copy of "+t.duplicated,delete t.upstreamoperationplans,delete t.downstreamoperationplans,delete t.pegging_demand),void 0!==a.operationplan__startdate&&""!==a.operationplan__startdate?t.start=a.operationplan__startdate:void 0!==a.startdate&&""!==a.startdate&&(t.start=a.startdate),void 0!==a.operationplan__enddate&&""!==a.operationplan__enddate?t.end=a.operationplan__enddate:void 0!==a.enddate&&""!==a.enddate&&(t.end=a.enddate),void 0!==a.operationplan__quantity&&""!==a.operationplan__quantity?t.quantity=parseFloat(a.operationplan__quantity):void 0!==a.quantity&&""!==a.quantity&&(t.quantity=parseFloat(a.quantity)),void 0!==a.operationplan__status&&""!==a.operationplan__status?t.status=a.operationplan__status:void 0!==a.status&&""!==a.status&&(t.status=a.status),void 0!==a.operationplan__quantity_completed&&""!==a.operationplan__quantity_completed?t.quantity_completed=parseFloat(a.operationplan__quantity_completed):void 0!==a.quantity_completed&&""!==a.quantity_completed&&(t.quantity_completed=parseFloat(a.quantity_completed)),void 0!==t.invstatus&&(t.invstatus.pipeline=0),!e.operationplan.hasOwnProperty("start")||e.operationplan.start instanceof Date||(e.operationplan.start=moment(e.operationplan.start,datetimeformat).toDate()),!e.operationplan.hasOwnProperty("end")||e.operationplan.end instanceof Date||(e.operationplan.end=moment(e.operationplan.end,datetimeformat).toDate()),!e.operationplan.hasOwnProperty("operationplan__startdate")||e.operationplan.operationplan__startdate instanceof Date||(e.operationplan.operationplan__startdate=moment(e.operationplan.operationplan__startdate,datetimeformat).toDate()),!e.operationplan.hasOwnProperty("operationplan__enddate")||e.operationplan.operationplan__enddate instanceof Date||(e.operationplan.operationplan__enddate=moment(e.operationplan.operationplan__enddate,datetimeformat).toDate())}},e.refreshstatus=function(a){"no_action"!==a&&e.$apply(function(){e.operationplan.status=a})},e.setMode=function(a){function t(){n.save("mode",a),e.$apply(function(){e.operationplan=null,e.mode=a}),angular.element("#controller").scope().$broadcast("changeMode",a),"kanban"==a?($("#gridmode, #calendarmode").removeClass("active"),$("#kanbanmode").addClass("active"),mode="kanban",e.loadKanbanData()):a.startsWith("calendar")?($("#kanbanmode, #gridmode").removeClass("active"),$("#calendarmode").addClass("active"),mode=a):($("#kanbanmode, #calendarmode").removeClass("active"),$("#gridmode").addClass("active"),mode="grid",angular.element(document).find("#grid").jqGrid("GridUnload"),initialfilter=thefilter,displayGrid(!0)),setHeights()}var r=angular.element(document).find("#save");return e.mode!=a&&r.hasClass("btn-danger")?($("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header alert-warning" style="border-top-left-radius: inherit; border-top-right-radius: inherit"><h5 class="modal-title">'+gettext("Save or cancel your changes first")+'</h5></div><div class="modal-body">'+gettext("There are unsaved changes on this page.")+'</div><div class="modal-footer justify-content-between"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary" value="'+gettext("Return to page")+'"><input type="submit" id="savebutton" role="button" class="btn btn-danger" value="'+gettext("Save")+'"></div></div></div>'),showModal("popup"),$("#savebutton").on("click",function(){r.trigger("click"),t(),hideModal("popup")}),$("#cancelbutton").on("click",function(){hideModal("popup")}),!1):(t(),!0)},e.displayonpanel=function(a,t,n){angular.element(document.getElementById(e.operationplan.id)).removeClass("edited").addClass("edited"),void 0!==e.operationplan.id&&a===e.operationplan.id.toString()&&("startdate"!==t&&"operationplan__startdate"!==t||e.$apply(function(){e.operationplan.start=n instanceof Date?n:new Date(n)}),"enddate"!==t&&"operationplan__enddate"!==t||e.$apply(function(){e.operationplan.end=n instanceof Date?n:new Date(n)}),"quantity"===t&&e.$apply(function(){e.operationplan.quantity=parseFloat(n)}),"status"===t&&e.refreshstatus(n),"quantity_completed"===t&&e.$apply(function(){e.operationplan.quantity_completed=parseFloat(n)}))},e.calendarevents=[],e.calendarStart=null,e.calendarEnd=null,e.mode=preferences&&preferences.mode||"table",e.calendarRangeChanged=function(a,t){e.calendarStart=a,e.calendarEnd=t,e.mode&&e.mode.startsWith("calendar")&&o()},e.loadCalendarData=o,e.loadKanbanData=function(t){if(!t){var n=$("#grid").getGridParam("postData");t=n&&n.filters?JSON.parse(n.filters):initialfilter}var o=$("#grid").getGridParam("sortname"),i="";""!==o&&(i="&sidx="+encodeURIComponent(o)+"&sord="+encodeURIComponent($("#grid").getGridParam("sortorder")));var d=(-1!=location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):location.href)+(location.search.length>0?"&format=kanban":"?format=kanban");angular.forEach(e.kanbancolumns,function(n){var o=angular.copy(t),l={field:e.groupBy,op:e.groupOperator,data:n};void 0===o||null===o?o={groupOp:"AND",rules:[l],groups:[]}:"AND"==o.groupOp?o.rules.push(l):o={groupOp:"AND",rules:[l],groups:[o]},a.get(d+"&filters="+encodeURIComponent(JSON.stringify(o))+i).then(function(a){var t=angular.copy(a.data);for(var o of t.rows)o.type=o.operationplan__type||o.type||default_operationplan_type,o.hasOwnProperty("enddate")&&(o.enddate=new Date(o.enddate)),o.hasOwnProperty("operationplan__enddate")&&(o.operationplan__enddate=new Date(o.operationplan__enddate)),o.hasOwnProperty("startdate")&&(o.startdate=new Date(o.startdate)),o.hasOwnProperty("operationplan__startdate")&&(o.operationplan__startdate=new Date(o.operationplan__startdate)),o.hasOwnProperty("quantity")&&(o.quantity=parseFloat(o.quantity)),o.hasOwnProperty("operationplan__quantity")&&(o.operationplan__quantity=parseFloat(o.operationplan__quantity)),o.hasOwnProperty("quantity_completed")&&(o.quantity_completed=parseFloat(o.quantity_completed)),o.hasOwnProperty("operationplan__quantity_completed")&&(o.operationplan__quantity_completed=parseFloat(o.operationplan__quantity_completed)),o.hasOwnProperty("operationplan__status")&&(o.status=o.operationplan__status),o.hasOwnProperty("operationplan__origin")&&(o.origin=o.operationplan__origin),[o.color,o.inventory_status]=r(o);e.kanbanoperationplans[n]=t},function(e){401==e.status&&location.reload()})})},e.getDirtyCards=function(){var a=[];return e.mode&&e.mode.startsWith("calendar")?angular.forEach(e.calendarevents,function(e){var t={id:e.id||e.reference},n=!1;if(e.duplicated){var r={quantity:e.quantity,startdate:new moment(e.operationplan__startdate||e.startdate).format("YYYY-MM-DD HH:mm:ss"),enddate:new moment(e.operationplan__enddate||e.enddate).format("YYYY-MM-DD HH:mm:ss"),status:e.status,type:e.type};"PO"==e.type?(r.supplier=e.operationplan__supplier__name||e.supplier,r.location=e.operationplan__location__name||e.location,r.item=e.operationplan__item__name||e.item):"DO"==e.type?(r.origin=e.operationplan__origin__name||e.origin,r.destination=e.operationplan__destination__name||e.destination,r.item=e.operationplan__item__name||e.item):"MO"==e.type&&(r.operation=e.operationplan__operation__name||e.operation),e.resource&&(r.resource=e.resource),a.push(r)}else{for(var o in e.hasOwnProperty("operationplan__reference")&&(t.operationplan__reference=e.operationplan__reference),e)e.hasOwnProperty(o+"Original")&&(n=!0,e[o]instanceof Date?t[o]=new moment(e[o]).format("YYYY-MM-DD HH:mm:ss"):t[o]=e[o]);n&&a.push(t)}}):"kanban"==e.mode&&angular.forEach(e.kanbanoperationplans,function(e,t){angular.forEach(e.rows,function(e){var t={id:e.id||e.reference},n=!1;if(e.duplicated){var r={quantity:e.quantity,startdate:new moment(e.operationplan__startdate||e.startdate).format("YYYY-MM-DD HH:mm:ss"),enddate:new moment(e.operationplan__enddate||e.enddate).format("YYYY-MM-DD HH:mm:ss"),status:e.operationplan__status||e.status,type:e.type};"PO"==e.type?(r.supplier=e.operationplan__supplier||e.supplier,r.location=e.operationplan__location||e.location,r.item=e.operationplan__item||e.item):"DO"==e.type?(r.origin=e.operationplan__origin||e.origin,r.destination=e.operationplan__destination||e.destination,r.item=e.operationplan__item||e.item):"MO"==e.type&&(r.operation=e.operationplan__operation__name||e.operation,console.log("dddd",r)),a.push(r)}for(var o in e.hasOwnProperty("operationplan__reference")&&(t.operationplan__reference=e.operationplan__reference),e)e.hasOwnProperty(o+"Original")&&(n=!0,e[o]instanceof Date?t[o]=new moment(e[o]).format("YYYY-MM-DD HH:mm:ss"):t[o]=e[o]);n&&a.push(t)})}),e.deleted&&e.deleted.length&&(a.push({delete:e.deleted}),e.deleted=[]),a!=[]&&(e.operationplan=void 0),a},e.duplicateOperationPlan=function(){var a=[];e.mode&&e.mode.startsWith("calendar")?(e.$apply(function(){for(var t of(angular.forEach(e.calendarevents,function(t){if(e.operationplan.id==t.operationplan__reference||e.operationplan.id==t.reference){var n=angular.copy(t);t.operationplan__reference&&(n.hasOwnProperty("duplicated")||(n.duplicated=t.operationplan__reference),n.operationplan__reference=t.operationplan__reference&&t.operationplan__reference.startsWith("Copy of")?t.operationplan__reference:"Copy of "+t.operationplan__reference),t.id&&(n.hasOwnProperty("duplicated")||(n.duplicated=t.id),n.id=t.id&&t.id.startsWith("Copy of")?t.id:"Copy of "+t.id,n.duplicated=t.duplicated?t.duplicated:t.reference),t.reference&&(n.hasOwnProperty("duplicated")||(n.duplicated=t.reference),n.reference=t.reference&&t.reference.startsWith("Copy of")?t.reference:"Copy of "+t.reference),n.dirty=!0,a.push([t,n]),e.totalevents+=1}}),a))e.calendarevents.push(t[1]),e.$broadcast("duplicateOperationplan",t[0],t[1])}),angular.element(document).find("#save, #undo").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges),$(window).on("beforeunload",upload.warnUnsavedChanges)):"kanban"==e.mode&&e.$apply(function(){angular.forEach(e.kanbanoperationplans,function(t){for(var n of(a=[],angular.forEach(t.rows,function(t){if(e.operationplan.id==t.operationplan__reference||e.operationplan.id==t.reference){var n=angular.copy(t);t.operationplan__reference&&(n.hasOwnProperty("duplicated")||(n.duplicated=t.operationplan__reference),n.operationplan__reference=t.operationplan__reference&&t.operationplan__reference.startsWith("Copy of")?t.operationplan__reference:"Copy of "+t.operationplan__reference),t.id&&(n.hasOwnProperty("duplicated")||(n.duplicated=t.id),n.id=t.id&&t.id.startsWith("Copy of")?t.id:"Copy of "+t.id),t.reference&&(n.hasOwnProperty("duplicated")||(n.duplicated=t.reference),n.reference=t.reference&&t.reference.startsWith("Copy of")?t.reference:"Copy of "+t.reference),a.push([t,n]),n.dirty=!0}}),a))t.rows.push(n[1]),e.$broadcast("duplicateOperationplan",n[0],n[1])}),angular.element(document).find("#save, #undo").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges),$(window).on("beforeunload",upload.warnUnsavedChanges)})},e.removeOperationPlan=function(){e.operationplan&&e.operationplan.reference&&(e.mode&&e.mode.startsWith("calendar")?(e.$apply(function(){e.calendarevents=e.calendarevents.filter(a=>a.operationplan__reference!=e.operationplan.reference&&a.reference!=e.operationplan.reference),e.deleted.push(e.operationplan.reference),e.operationplan=new t}),angular.element(document).find("#delete_selected, #copy_selected").prop("disabled",!0),angular.element(document).find("#save, #undo").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges),$(window).on("beforeunload",upload.warnUnsavedChanges)):e.mode&&"kanban"==e.mode&&(e.$apply(function(){for(var a in e.kanbanoperationplans)e.kanbanoperationplans[a].rows=e.kanbanoperationplans[a].rows.filter(a=>a.operationplan__reference!=e.operationplan.reference&&a.reference!=e.operationplan.reference);e.deleted.push(e.operationplan.reference),e.operationplan=new t}),angular.element(document).find("#delete_selected, #copy_selected").prop("disabled",!0),angular.element(document).find("#save, #undo").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges),$(window).on("beforeunload",upload.warnUnsavedChanges)))},preferences&&"kanban"==preferences.mode&&e.loadKanbanData()}function showproblemspanelDrv(e,a){return{restrict:"EA",scope:{operationplan:"=data"},link:function(e,t,n){var r='<div class="card-header"><h5 class="card-title" style="text-transform: capitalize">'+a.getString("problems")+'</h5></div><table class="table table-sm table-hover table-borderless"><thead><tr><td><b style="text-transform: capitalize;">'+a.getString("name")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("start")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("end")+"</b></td></tr></thead><tbody></tbody></table>";e.$watchGroup(["operationplan.id","operationplan.problems.length"],function(t,n){angular.element(document).find("#attributes-operationproblems").empty().append(r);var o='<tr><td colspan="3">'+a.getString("no problems")+"</td></tr>";void 0!==e.operationplan&&e.operationplan.hasOwnProperty("problems")&&(o="",angular.forEach(e.operationplan.problems,function(e){o+="<tr><td>"+e.description+"</td><td>"+e.start+"</td><td>"+e.end+"</td></tr>"})),angular.element(document).find("#attributes-operationproblems tbody").append(o)})}}}function showresourcespanelDrv(e,a){return{restrict:"EA",scope:{operationplan:"=data",mode:"=mode"},link:function(e,t,n){var r='<div class="card-header"><h5 class="card-title" style="text-transform: capitalize">'+a.getString("resource")+'</h5></div><div class="card-body"><table class="table table-sm table-hover table-borderless"><thead><tr><td><b style="text-transform: capitalize;">'+a.getString("name")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("quantity")+"</b></td><tbody></tbody></table></div>";e.$watchGroup(["operationplan.id","operationplan.loadplans.length"],function t(){angular.element(document).find("#attributes-operationresources").empty().append(r);var n='<tr><td colspan="2">'+a.getString("no resources")+"</td></tr>";void 0!==e.operationplan&&e.operationplan.hasOwnProperty("loadplans")&&(n="",angular.forEach(e.operationplan.loadplans,function(e){e.hasOwnProperty("alternates")?(n+='<tr><td style="white-space: nowrap;"><div class="dropdown"><button class="form-control w-auto dropdown-toggle" data-bs-toggle="dropdown" type="button" style="min-width: 150px">'+$.jgrid.htmlEncode(e.resource.name)+'</button><ul class="dropdown-menu"><li><a role="menuitem" class="dropdown-item alternateresource text-capitalize">'+$.jgrid.htmlEncode(e.resource.name)+"</a></li>",angular.forEach(e.alternates,function(e){n+='<li><a role="menuitem" class="dropdown-item alternateresource text-capitalize">'+$.jgrid.htmlEncode(e.name)+"</a></li>"}),n+="</ul></td><td>"+grid.formatNumber(e.quantity)+"</td></tr>"):n+="<tr><td>"+$.jgrid.htmlEncode(e.resource.name)+'<a href="'+url_prefix+"/detail/input/resource/"+admin_escape(e.resource.name)+"/\" onclick='event.stopPropagation()'><span class='ps-2 fa fa-caret-right'></span></a></td><td>"+grid.formatNumber(e.quantity)+"</td></tr>"}));angular.element(document).find("#attributes-operationresources tbody").append(n);angular.element(document).find("#attributes-operationresources a.alternateresource").bind("click",function(){var a=$(this).html(),n=$(this).parent().parent().prev().html();if(a!=n){var r=!0;angular.forEach(e.operationplan.loadplans,function(o){if(o.resource.name==n&&r){if(r=!1,o.resource.name=a,angular.forEach(o.alternates,function(e){e.name===a&&(e.name=n)}),t(),e.mode&&(e.mode.startsWith("calendar")||"kanban"==e.mode))e.$emit("updateCard","loadplans",e.operationplan.loadplansOriginal,e.operationplan.loadplans);else{var i=angular.element(document).find("#grid"),d=i.jqGrid("getGridParam","selarrrow"),l=i.jqGrid("getGridParam","colModel").find(function(e){return"resources"==e.name});l||(l=i.jqGrid("getGridParam","colModel").find(function(e){return"resource"==e.name}));var p=i.jqGrid("getCell",d,l.name);if("detail"==l.formatter&&p==n)i.jqGrid("setCell",d,l.name,a,"dirty-cell"),i.jqGrid("setRowData",d,!1,"edited"),angular.element(document).find("#save").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1),angular.element(document).find("#undo").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges),$(window).on("beforeunload",upload.warnUnsavedChanges);else if("listdetail"==l.formatter){var s=[];angular.forEach(e.operationplan.loadplans,function(e){s.push([e.resource.name,e.quantity])}),i.jqGrid("setCell",d,l.name,s,"dirty-cell"),i.jqGrid("setRowData",d,!1,"edited"),angular.element(document).find("#save").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1),angular.element(document).find("#undo").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges),$(window).on("beforeunload",upload.warnUnsavedChanges)}}return!1}})}})})}}}function showbufferspanelDrv(e,a,t){return{restrict:"EA",scope:{operationplan:"=data"},link:function(e,n,r){var o='<div class="card-header"><h5 class="card-title" style="text-transform: capitalize">'+a.getString("items")+'</h5></div><div class="card-body"><table class="table table-sm table-hover table-borderless"><thead><tr><td><b style="text-transform: capitalize;">'+a.getString("item")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("quantity")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("onhand")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("date")+"</b></td></tr></thead><tbody></tbody></table></div>";e.$watchGroup(["operationplan.id","operationplan.flowplans.length"],function n(){angular.element(document).find("#attributes-operationflowplans").empty().append(o);var r='<tr><td colspan="3">'+a.getString("no movements")+"<td></tr>";void 0!==e.operationplan&&e.operationplan.hasOwnProperty("flowplans")&&(r="",angular.forEach(e.operationplan.flowplans,function(e){r+="<tr>",e.hasOwnProperty("alternates")?(r+='<td style="white-space: nowrap"><div class="dropdown"><button class="btn btn-primary" data-bs-toggle="dropdown" type="button" style="text-transform: capitalize; min-width: 150px">'+$.jgrid.htmlEncode(e.buffer.item)+'</button><ul class="dropdown-menu"><li><a role="menuitem" class="dropdown-item alternateitem" style="text-transform: capitalize">'+$.jgrid.htmlEncode(e.buffer.item)+"</a></li>",angular.forEach(e.alternates,function(e){r+='<li><a role="menuitem" class="dropdown-item alternateitem" style="text-transform: capitalize">'+$.jgrid.htmlEncode(e)+"</a></li>"}),r+="</ul></td>"):(r+="<td><span ",e.buffer.description&&(r+=' onmouseenter="$(this).tooltip(\'show\')" title="'+$.jgrid.htmlEncode(e.buffer.description)+'"'),r+=">"+$.jgrid.htmlEncode(e.buffer.item)+'<a href="'+url_prefix+"/detail/input/item/"+admin_escape(e.buffer.item)+"/\" onclick='event.stopPropagation()'><span class='ps-2 fa fa-caret-right'></span></a></span></td>"),r+="<td>"+grid.formatNumber(e.quantity)+"</td><td>"+grid.formatNumber(e.onhand)+'</td><td style="white-space: nowrap">'+t("formatdatetime")(e.date)+"</td></tr>"}),angular.element(document).find("#attributes-operationflowplans thead").css("display","table-header-group"));angular.element(document).find("#attributes-operationflowplans tbody").append(r);angular.element(document).find("#attributes-operationflowplans a.alternateitem").bind("click",function(){var a=$(this).html(),t=$(this).parent().parent().prev().html();a!=t&&angular.forEach(e.operationplan.flowplans,function(r){if(r.buffer.item==t){r.buffer.item=a,n();var o=angular.element(document).find("#grid"),i=o.jqGrid("getGridParam","selarrrow"),d=o.jqGrid("getGridParam","colModel").find(function(e){return"material"==e.name}),l=o.jqGrid("getCell",i,"material");if("detail"==d.formatter&&l==t)o.jqGrid("setCell",i,"material",a,"dirty-cell"),o.jqGrid("setRowData",i,!1,"edited"),angular.element(document).find("#save").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1),angular.element(document).find("#undo").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1);else if("listdetail"==d.formatter){var p=[];angular.forEach(e.operationplan.flowplans,function(e){p.push([e.buffer.item,e.quantity])}),o.jqGrid("setCell",i,"material",p,"dirty-cell"),o.jqGrid("setRowData",i,!1,"edited"),angular.element(document).find("#save").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1),angular.element(document).find("#undo").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1)}return!1}})})})}}}function showoperationpeggingpanelDrv(e,a,t){return{restrict:"EA",scope:{operationplan:"=data"},link:function(e,n,r,o){var i='<div class="card-header"><h5 class="card-title" style="text-transform: capitalize">'+a.getString("demand")+'</h5></div><div class="card-body table-responsive" style="max-height:15em; overflow:auto"><table class="table table-sm table-hover table-borderless"><thead><tr><td><b style="text-transform: capitalize;">'+a.getString("name")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("item")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("due")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("quantity")+"</b></td><tbody></tbody></table></div>";e.$watchGroup(["operationplan.id","operationplan.pegging_demand.length"],function(n,r){angular.element(document).find("#attributes-operationdemandpegging").empty().append(i);var o='<tr><td colspan="2">'+a.getString("no demands")+"</td></tr>";void 0!==e.operationplan&&e.operationplan.hasOwnProperty("pegging_demand")&&(o="",angular.forEach(e.operationplan.pegging_demand,function(e){o+="<tr><td>"+$.jgrid.htmlEncode(e.demand.name)+'<a href="'+url_prefix+(e.demand.forecast?"/detail/forecast/forecast/":"/detail/input/demand/")+admin_escape(e.demand.name)+"/\" onclick='event.stopPropagation()'><span class='ps-2 fa fa-caret-right'></span></a></td><td>",e.demand.item.description?o+='<span onmouseenter="$(this).tooltip(\'show\')" title="'+$.jgrid.htmlEncode(e.demand.item.description)+'">'+$.jgrid.htmlEncode(e.demand.item.name)+"</span>":o+=$.jgrid.htmlEncode(e.demand.item.name),o+='<a href="'+url_prefix+"/detail/input/item/"+admin_escape(e.demand.item.name)+"/\" onclick='event.stopPropagation()'><span class='ps-2 fa fa-caret-right'></span></a></td><td>"+t("formatdate")(e.demand.due)+"</td><td>"+grid.formatNumber(e.quantity)+"</td></tr>"})),angular.element(document).find("#attributes-operationdemandpegging tbody").append(o)})}}}function showoperationplanDrv(e,a){return{restrict:"EA",scope:!0,templateUrl:"/static/operationplandetail/operationplanpanel.html",link:function(e,t,n){e.actions=actions,e.editable=editable,e.opptype={MO:a.getString("manufacturing order"),PO:a.getString("purchase order"),DO:a.getString("distribution order"),STCK:a.getString("stock"),DLVR:a.getString("delivery")},e.$on("cardChanged",function(a,t,n,r){e.operationplan&&("startdate"===t?e.operationplan.start=r:"enddate"===t?e.operationplan.end=r:e.operationplan[t]=r)}),e.$watchGroup(["operationplan.id","operationplan.start","operationplan.end","operationplan.quantity","operationplan.completed_quantity","operationplan.criticality","operationplan.delay","operationplan.status","operationplan.remark"],function(a,n){void 0!==e.operationplan&&null!==e.operationplan&&(-1==e.operationplan.id||"STCK"===e.operationplan.type?(angular.element(t).find("input").attr("disabled","disabled"),angular.element(t).find("#statusrow .btn").removeClass("active").attr("disabled","disabled")):void 0!==e.operationplan.id?(angular.element(t).find("input[disabled]").attr("disabled",!1),"undefined"!=typeof actions&&actions.hasOwnProperty("proposed")&&angular.element(t).find("button[disabled]").attr("disabled",!1),angular.element(t).find("#statusrow .btn").removeClass("active"),e.operationplan.hasOwnProperty("start")&&angular.element(t).find("#setStart").val(moment.utc(e.operationplan.start,datetimeformat).format(datetimeformat)),e.operationplan.hasOwnProperty("end")&&angular.element(t).find("#setEnd").val(moment.utc(e.operationplan.end,datetimeformat).format(datetimeformat)),e.operationplan.hasOwnProperty("status")&&(angular.element(t).find("#statusrow .btn").removeClass("active"),angular.element(t).find("#"+e.operationplan.status+"Btn").addClass("active"))):(angular.element(t).find("input").attr("disabled","disabled"),angular.element(t).find("#statusrow .btn").removeClass("active").attr("disabled","disabled"),angular.element(t).find("#setStart").val(""),angular.element(t).find("#setEnd").val("")),angular.element(t).find("#statusrow").css("display",e.operationplan.status&&"STCK"!==e.operationplan.type?"table-row":"none"))})}}}function showsupplyinformationDrv(e,a){return{restrict:"EA",scope:{operationplan:"=data"},link:function(e,t,n){var r='<div class="card-header"><h5 class="card-title" style="text-transform: capitalize">'+a.getString("supply information")+'</h5></div><div class="table-responsive"><table class="table table-hover table-sm"><thead><tr><td><b style="text-transform: capitalize;">'+a.getString("priority")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("types")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("origin")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("lead time")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("cost")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("size minimum")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("size multiple")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("effective start")+'</b></td><td><b style="text-transform: capitalize;">'+a.getString("effective end")+"</b></td></tr></thead><tbody></tbody></table></div>";e.$watchGroup(["operationplan.id","operationplan.attributes.supply.length"],function(t,n){angular.element(document).find("#attributes-supplyinformation").empty().append(r);var o='<tr><td colspan="9">'+a.getString("no supply information")+"</td></tr>";void 0!==e.operationplan&&e.operationplan.attributes.hasOwnProperty("supply")&&(o="",angular.forEach(e.operationplan.attributes.supply,function(e){for(var a in o+="<tr>",e)o+="<td>",o+=e[a],o+="</td>";o+="</tr>"})),angular.element(document).find("#attributes-supplyinformation tbody").append(o)})}}}function showdownstreamoperationplansDrv(e,a){return{restrict:"EA",scope:{operationplan:"=data"},templateUrl:"/static/operationplandetail/downstreamoperationplans.html",link:function(e,a,t){e.expandOrCollapse=function(a){var t=a+1,n=e.operationplan.downstreamoperationplans[a][0];0==e.operationplan.downstreamoperationplans[a][11]?e.operationplan.downstreamoperationplans[a][11]=1:e.operationplan.downstreamoperationplans[a][11]=0;for(;t<e.operationplan.downstreamoperationplans.length&&!(e.operationplan.downstreamoperationplans[t][0]<=n);)e.operationplan.downstreamoperationplans[t][0]>n+1||0==e.operationplan.downstreamoperationplans[a][11]?e.operationplan.downstreamoperationplans[t][11]=2:t==e.operationplan.downstreamoperationplans.length-1||e.operationplan.downstreamoperationplans[t][0]>=e.operationplan.downstreamoperationplans[t+1][0]?e.operationplan.downstreamoperationplans[t][11]=3:e.operationplan.downstreamoperationplans[t][0]==n+1&&1==e.operationplan.downstreamoperationplans[a][11]&&(e.operationplan.downstreamoperationplans[t][11]=0),++t},e.url_prefix=url_prefix}}}function showupstreamoperationplansDrv(e,a){return{restrict:"EA",scope:{operationplan:"=data"},templateUrl:"/static/operationplandetail/upstreamoperationplans.html",link:function(e,a,t){e.expandOrCollapse=function(a){var t=a+1,n=e.operationplan.upstreamoperationplans[a][0];0==e.operationplan.upstreamoperationplans[a][11]?e.operationplan.upstreamoperationplans[a][11]=1:e.operationplan.upstreamoperationplans[a][11]=0;for(;t<e.operationplan.upstreamoperationplans.length&&!(e.operationplan.upstreamoperationplans[t][0]<=n);)e.operationplan.upstreamoperationplans[t][0]>n+1||0==e.operationplan.upstreamoperationplans[a][11]?e.operationplan.upstreamoperationplans[t][11]=2:t==e.operationplan.upstreamoperationplans.length-1||e.operationplan.upstreamoperationplans[t][0]>=e.operationplan.upstreamoperationplans[t+1][0]?e.operationplan.upstreamoperationplans[t][11]=3:e.operationplan.upstreamoperationplans[t][0]==n+1&&1==e.operationplan.upstreamoperationplans[a][11]&&(e.operationplan.upstreamoperationplans[t][11]=0),++t},e.url_prefix=url_prefix}}}function showKanbanDrv(e,a,t,n){"use strict";return{restrict:"EA",scope:{operationplan:"=",kanbanoperationplans:"=",kanbancolumns:"=",editable:"="},templateUrl:"/static/operationplandetail/kanban.html",link:function(e,t,r){function o(e){e.preventDefault()}function i(a){var t=$(a.target).closest("div[data-column]").attr("data-column");if(t){var r=a.originalEvent.dataTransfer.getData("startcolumn"),o=a.originalEvent.dataTransfer.getData("startindex");if("undefined"!==o){var i=$(a.target).closest(".card");i&&(i=i.attr("data-index")),e.$apply(function(){var a=e.kanbanoperationplans[r].rows[o];e.kanbanoperationplans[r].rows.splice(o,1),i?e.kanbanoperationplans[t].rows.splice(i>o&&t==r?i-1:i,0,a):e.kanbanoperationplans[t].rows.unshift(a),e.kanbanoperationplans[r].records--,e.kanbanoperationplans[t].records++,angular.element(document).find("#save, #undo").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges),$(window).on("beforeunload",upload.warnUnsavedChanges),a.hasOwnProperty("operationplan__status")?a.hasOwnProperty("operationplan__statusOriginal")?(a.operationplan__statusOriginal==t?(a.dirty=!1,delete a.operationplan__statusOriginal):a.dirty=!0,a.operationplan__status=t,a.status=envalue):a.operationplan__status!=t&&(a.operationplan__statusOriginal=a.operationplan__status,a.operationplan__status=t,a.status=t,a.dirty=!0):a.hasOwnProperty("statusOriginal")?(a.statusOriginal==t?(a.dirty=!1,delete a.statusOriginal):a.dirty=!0,a.status=t):a.status!=t&&(a.statusOriginal=a.status,a.status=t,a.dirty=!0),e.$parent.$broadcast("cardChanged","status",a.statusOriginal,a.status)})}else e.$apply(function(){var a=e.kanbancolumns.indexOf(r),o=e.kanbancolumns.indexOf(t),i=e.kanbancolumns[a];e.kanbancolumns[a]=e.kanbancolumns[o],e.kanbancolumns[o]=i,n.save("columns",e.$parent.kanbancolumns)})}a.preventDefault()}function d(e){e.originalEvent.dataTransfer.setData("startindex",$(e.target).attr("data-index")),e.originalEvent.dataTransfer.setData("startcolumn",$(e.target).closest("div[data-column]").attr("data-column")),e.stopPropagation()}function l(){t.on("dragover","div[data-column], .card",o),t.on("drop","div[data-column]",i),t.on("dragstart","div[data-column] .panel .card-header, .card",d)}function p(){t.off("dragover","div[data-column], .card",o),t.off("drop","div[data-column]",i),t.off("dragstart","div[data-column] .panel .card-header, .card",d)}e.curselected=null,e.colstyle="col-md-1",e.type="PO",e.admin_escape=admin_escape,e.url_prefix=url_prefix,e.mode=mode,e.opptype={MO:a.getString("Manufacturing Order"),PO:a.getString("Purchase Order"),DO:a.getString("Distribution Order"),STCK:a.getString("Stock"),DLVR:a.getString("Delivery")},e.getHeight=function(e){return preferences&&preferences.height?preferences.height-(e||25):220},e.hideColumn=function(a){var t=e.$parent.kanbancolumns.indexOf(a);e.$parent.kanbancolumns.splice(t,1),n.save("columns",e.$parent.kanbancolumns)},e.grid=grid,e.selectCard=function(a){if(e.curselected){if(e.curselected.reference&&e.curselected.reference==a.reference&&a.selected)return;if(e.curselected.operationplan__reference&&e.curselected.operationplan__reference==a.reference&&a.selected)return;delete e.curselected.selected}a.selected=!0,e.curselected=a,e.$parent.displayInfo(a),angular.element(document).find("#delete_selected, #gridactions").prop("disabled",!1)},e.$on("selectedEdited",function(a,t,n,r){if(null!==e.curselected){if("loadplans"==t){var o=[];angular.forEach(r,function(e){o.push([e.resource.name,e.quantity])}),e.changeCard(e.curselected,"resource",e.curselected.resource,o),e.curselected.resource=o}else e.changeCard(e.curselected,t,n,r);if("status"===t){var i=e.kanbanoperationplans[n].rows.indexOf(e.curselected);-1!=i&&(e.kanbanoperationplans[n].rows.splice(i,1),e.kanbanoperationplans[r].rows.unshift(e.curselected),e.kanbanoperationplans[n].records--,e.kanbanoperationplans[r].records++)}"loadplans"!=t&&(e.curselected.hasOwnProperty("operationplan__"+t)?e.curselected["operationplan__"+t]=r:e.curselected[t]=r)}}),e.changeCard=function(a,t,n,r){a.hasOwnProperty(t+"Original")||(a[t+"Original"]=n),a.dirty=!0,angular.element(document).find("#save, #undo").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges),$(window).on("beforeunload",upload.warnUnsavedChanges),void 0!==r&&e.$parent.$broadcast("cardChanged",t,n,r)},e.enableDragDrop=l,e.disableDragDrop=p,e.$on("duplicateOperationplan",function(a,t,n){e.selectCard(n)}),e.$on("changeMode",function(a,t){e.mode=t,e.editable&&"kanban"==t?l():p()}),e.editable&&"kanban"==mode&&l()}}}operationplandetailapp.config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.xsrfCookieName="csrftoken",e.defaults.xsrfHeaderName="X-CSRFToken"}]),operationplandetailapp.run(["gettextCatalog",function(e){e.setCurrentLanguage(language)}]),operationplandetailapp.filter("formatdate",function(){return function(e){return moment.isMoment(e)?e.format(dateformat):e&&void 0!==e?moment(e,datetimeformat).format(dateformat):void 0}}),operationplandetailapp.filter("formatdatetime",function(){return function(e){if(moment.isMoment(e))return e.year()>1971?e.format(datetimeformat):"";if(e&&void 0!==e){var a=moment(e,datetimeformat);return a.year()>1971?a.format(datetimeformat):""}}}),operationplandetailapp.filter("formatnumber",function(){return function(e,a=6){if(void 0===e)return"";var t=$.fmatter.isNumber;if(t(e)||(e*=1),t(e)){var n,r=e<0,o=Math.abs(e);n=o>1e5||a<=0?String(parseFloat(e.toFixed())):o>1e4||a<=1?String(parseFloat(e.toFixed(1))):o>1e3||a<=2?String(parseFloat(e.toFixed(2))):o>100||a<=3?String(parseFloat(e.toFixed(3))):o>10||a<=4?String(parseFloat(e.toFixed(4))):o>1||a<=5?String(parseFloat(e.toFixed(5))):String(parseFloat(e.toFixed(a)));var i=jQuery("#grid").jqGrid("getGridRes","formatter.number.decimalSeparator")||".";"."!==i&&(n=n.replace(".",i));var d=jQuery("#grid").jqGrid("getGridRes","formatter.number.thousandsSeparator")||",";if(d){var l=n.lastIndexOf(i);l=l>-1?l:n.length;var p,s=void 0===i?"":n.substring(l),c=-1;for(p=l;p>0;p--)++c%3==0&&p!==l&&(!r||p>1)&&(s=d+s),s=n.charAt(p-1)+s;n=s}return n}return e}}),angular.module("operationplandetailapp").controller("operationplandetailCtrl",operationplanCtrl),operationplanCtrl.$inject=["$scope","$http","OperationPlan","PreferenceSvc"],angular.module("operationplandetailapp").directive("showproblemspanelDrv",showproblemspanelDrv),showproblemspanelDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showresourcespanelDrv",showresourcespanelDrv),showresourcespanelDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showbufferspanelDrv",showbufferspanelDrv),showbufferspanelDrv.$inject=["$window","gettextCatalog","$filter"],angular.module("operationplandetailapp").directive("showoperationpeggingpanelDrv",showoperationpeggingpanelDrv),showoperationpeggingpanelDrv.$inject=["$window","gettextCatalog","$filter"],angular.module("operationplandetailapp").directive("showoperationplanDrv",showoperationplanDrv),showoperationplanDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showsupplyinformationDrv",showsupplyinformationDrv),showsupplyinformationDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showdownstreamoperationplansDrv",showdownstreamoperationplansDrv),showdownstreamoperationplansDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showupstreamoperationplansDrv",showupstreamoperationplansDrv),showupstreamoperationplansDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showKanbanDrv",showKanbanDrv),showKanbanDrv.$inject=["$window","gettextCatalog","OperationPlan","PreferenceSvc"];
//# sourceMappingURL=frepple-operationplandetail.min.js.map